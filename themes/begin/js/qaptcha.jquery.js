jQuery(function(){jQuery.extend(jQuery.support,{touch:"ontouchend" in document});if($.support.touch){var obj=document.getElementsByClassName("qaptcha");for(i=0;i<obj.length;i++){obj[i].addEventListener("touchstart",iPadTouchHandler,false);obj[i].addEventListener("touchmove",iPadTouchHandler,false);obj[i].addEventListener("touchend",iPadTouchHandler,false);obj[i].addEventListener("touchcancel",iPadTouchHandler,false)}}});var lastTap=null;var tapValid=false;var tapTimeout=null;function cancelTap(){tapValid=false}var rightClickPending=false;var rightClickEvent=null;var holdTimeout=null;var cancelMouseUp=false;function cancelHold(){if(rightClickPending){window.clearTimeout(holdTimeout);rightClickPending=false;rightClickEvent=null}}function startHold(event){if(rightClickPending){return}rightClickPending=true;rightClickEvent=(event.changedTouches)[0];holdTimeout=window.setTimeout("doRightClick();",800)}function doRightClick(){rightClickPending=false;var first=rightClickEvent,simulatedEvent=document.createEvent("MouseEvent");simulatedEvent.initMouseEvent("mouseup",true,true,window,1,first.screenX,first.screenY,first.clientX,first.clientY,false,false,false,false,0,null);first.target.dispatchEvent(simulatedEvent);simulatedEvent=document.createEvent("MouseEvent");simulatedEvent.initMouseEvent("mousedown",true,true,window,1,first.screenX,first.screenY,first.clientX,first.clientY,false,false,false,false,2,null);first.target.dispatchEvent(simulatedEvent);simulatedEvent=document.createEvent("MouseEvent");simulatedEvent.initMouseEvent("contextmenu",true,true,window,1,first.screenX+50,first.screenY+5,first.clientX+50,first.clientY+5,false,false,false,false,2,null);first.target.dispatchEvent(simulatedEvent);cancelMouseUp=true;rightClickEvent=null}function iPadTouchStart(event){var touches=event.changedTouches,first=touches[0],type="mouseover",simulatedEvent=document.createEvent("MouseEvent");simulatedEvent.initMouseEvent(type,true,true,window,1,first.screenX,first.screenY,first.clientX,first.clientY,false,false,false,false,0,null);first.target.dispatchEvent(simulatedEvent);type="mousedown";simulatedEvent=document.createEvent("MouseEvent");simulatedEvent.initMouseEvent(type,true,true,window,1,first.screenX,first.screenY,first.clientX,first.clientY,false,false,false,false,0,null);first.target.dispatchEvent(simulatedEvent);if(!tapValid){lastTap=first.target;tapValid=true;tapTimeout=window.setTimeout("cancelTap();",600);startHold(event)}else{window.clearTimeout(tapTimeout);if(first.target==lastTap){lastTap=null;tapValid=false;type="click";simulatedEvent=document.createEvent("MouseEvent");simulatedEvent.initMouseEvent(type,true,true,window,1,first.screenX,first.screenY,first.clientX,first.clientY,false,false,false,false,0,null);first.target.dispatchEvent(simulatedEvent);type="dblclick";simulatedEvent=document.createEvent("MouseEvent");simulatedEvent.initMouseEvent(type,true,true,window,1,first.screenX,first.screenY,first.clientX,first.clientY,false,false,false,false,0,null);first.target.dispatchEvent(simulatedEvent)}else{lastTap=first.target;tapValid=true;tapTimeout=window.setTimeout("cancelTap();",600);startHold(event)}}}function iPadTouchHandler(event){var type="",button=0;if(event.touches.length>1){return}switch(event.type){case"touchstart":if($(event.changedTouches[0].target).is("select")){return}iPadTouchStart(event);event.preventDefault();return false;break;case"touchmove":cancelHold();type="mousemove";event.preventDefault();break;case"touchend":if(cancelMouseUp){cancelMouseUp=false;event.preventDefault();return false}cancelHold();type="mouseup";break;default:return}var touches=event.changedTouches,first=touches[0],simulatedEvent=document.createEvent("MouseEvent");simulatedEvent.initMouseEvent(type,true,true,window,1,first.screenX,first.screenY,first.clientX,first.clientY,false,false,false,false,button,null);first.target.dispatchEvent(simulatedEvent);if(type=="mouseup"&&tapValid&&first.target==lastTap){simulatedEvent=document.createEvent("MouseEvent");simulatedEvent.initMouseEvent("click",true,true,window,1,first.screenX,first.screenY,first.clientX,first.clientY,false,false,false,false,button,null);first.target.dispatchEvent(simulatedEvent)}}jQuery.QapTcha={build:function(options){var defaults={txtLock:"滑动解锁才能提交",txtUnlock:"已解锁！",disabledSubmit:false,autoRevert:true,PHPfile:QaptchaJqueryPage,autoSubmit:false};if(this.length>0){return jQuery(this).each(function(i){var opts=jQuery.extend(defaults,options),$this=jQuery(this),form=jQuery("form").has($this),Clr=jQuery("<div>",{"class":"clr"}),bgSlider=jQuery("<div>",{"class":"bgslider"}),Slider=jQuery("<div>",{"class":"slider"}),Icons=jQuery("<div>",{"class":"Icons"}),dis=jQuery(""),TxtStatus=jQuery("<div>",{"class":" txtstatus droperror",text:opts.txtLock}),inputQapTcha=jQuery("<input>",{name:generatePass(32),value:generatePass(7),type:"hidden"});if(opts.disabledSubmit){form.find("input[type='submit']").attr("disabled","disabled")}bgSlider.appendTo($this);Icons.insertAfter(bgSlider);
TxtStatus.insertAfter(Icons);Clr.insertAfter(TxtStatus);dis.insertAfter(Clr);inputQapTcha.appendTo($this);Slider.appendTo(bgSlider);$this.show();Slider.draggable({revert:function(){if(opts.autoRevert){if(parseInt(Slider.css("left"))>5){return false}else{return true}}},containment:bgSlider,axis:"x",stop:function(event,ui){if(ui.position.left>15){$.post(opts.PHPfile,{action:"qaptcha",qaptcha_key:inputQapTcha.attr("name")},function(data){if(!data.error){Slider.draggable("disable").css("cursor","default");inputQapTcha.val("");TxtStatus.text(opts.txtUnlock).addClass("dropSuccess").removeClass("dropError");Icons.css("background-position","-16px 0");form.find("input[type='submit']").removeAttr("disabled")}},"json")}}});function generatePass(nb){var chars="azertyupqsdfghjkmwxcvbn23456789AZERTYUPQSDFGHJKMWXCVBN_-#@";var pass="";for(i=0;i<nb;i++){var wpos=Math.round(Math.random()*chars.length);pass+=chars.substring(wpos,wpos+1)}return pass}})}}};jQuery.fn.QapTcha=jQuery.QapTcha.build;